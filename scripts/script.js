// ==================== –î–ê–ù–ù–´–ï –ü–†–û–ï–ö–¢–û–í ====================

const projectsData = {
    0: {
        title: "–õ–∏—á–Ω—ã–π —Å–∞–π—Ç",
        category: "HTML, CSS",
        description: "–ú–æ–π –ø–µ—Ä–≤—ã–π –≤–µ–±-–ø—Ä–æ–µ–∫—Ç ‚Äî –ª–∏—á–Ω–∞—è –≤–∏–∑–∏—Ç–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞",
        fullDescription: "–í —ç—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–µ —è –ø—Ä–∏–º–µ–Ω–∏–ª –Ω–∞–≤—ã–∫–∏ HTML5 –∏ CSS3, —Å–æ–∑–¥–∞–≤ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ä–æ—à–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –≤–µ—Ä—Å—Ç–∫–∏ —Å Flexbox –∏ Grid.",
        technologies: ["HTML5", "CSS3", "Flexbox", "CSS Grid"],
        github: "https://github.com/sablin1412",
        demo: "https://sablin1412.github.io/resume/",
        image: "images/project1.jpg"
    },
    1: {
        title: "Todo-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ",
        category: "JavaScript",
        description: "–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö",
        fullDescription: "–°–æ–∑–¥–∞–Ω–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤–∞–Ω–∏–ª—å–Ω–æ–≥–æ JavaScript. –í—Å–µ –∑–∞–¥–∞—á–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ localStorage –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Å–µ–∞–Ω—Å–∞–º–∏. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è, —É–¥–∞–ª–µ–Ω–∏—è –∏ –æ—Ç–º–µ—Ç–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á.",
        technologies: ["JavaScript", "HTML5", "CSS3", "LocalStorage"],
        github: "https://github.com/sablin1412",
        demo: "https://example.com/todo",
        image: "images/project2.jpg"
    },
    2: {
        title: "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω",
        category: "React",
        description: "–°–∞–π—Ç —Å –∫–æ—Ä–∑–∏–Ω–æ–π –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π —Ç–æ–≤–∞—Ä–æ–≤",
        fullDescription: "–ü–æ—Å—Ç—Ä–æ–µ–Ω–æ –Ω–∞ React —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞. E-commerce –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é: –∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ä–∑–∏–Ω–∞ –ø–æ–∫—É–ø–æ–∫, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫.",
        technologies: ["React", "JavaScript", "CSS3", "API"],
        github: "https://github.com/sablin1412",
        demo: "https://example.com/shop",
        image: "images/project3.jpg"
    },
    3: {
        title: "–ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ Bootstrap",
        category: "Bootstrap, CSS",
        description: "–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —à–∞–±–ª–æ–Ω –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ Bootstrap",
        fullDescription: "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω Bootstrap –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –º–∞–∫–µ—Ç–∞. –î–∏–∑–∞–π–Ω –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –≤—Å–µ—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ —ç–∫—Ä–∞–Ω–æ–≤.",
        technologies: ["Bootstrap", "CSS3", "Responsive Design"],
        github: "https://github.com/sablin1412",
        demo: "https://example.com/portfolio",
        image: "images/project4.jpg"
    },
    4: {
        title: "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä",
        category: "JavaScript, HTML, CSS",
        description: "–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –≤–µ–±-–∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å –∏—Å—Ç–æ—Ä–∏–µ–π –æ–ø–µ—Ä–∞—Ü–∏–π",
        fullDescription: "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ –∏–º–µ–µ—Ç —É–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.",
        technologies: ["JavaScript", "HTML5", "CSS3"],
        github: "https://github.com/sablin1412",
        demo: "https://example.com/calc",
        image: "images/project5.jpg"
    },
    5: {
        title: "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ü–æ–≥–æ–¥–∞",
        category: "React, API",
        description: "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ–≥–æ–¥—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏",
        fullDescription: "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç React –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏ –≤–Ω–µ—à–Ω–µ–µ API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–≥–æ–¥–µ.",
        technologies: ["React", "API", "JavaScript", "CSS3"],
        github: "https://github.com/sablin1412",
        demo: "https://example.com/weather",
        image: "images/project6.jpg"
    }
};

// ==================== –ü–†–ê–ö–¢–ò–ö–ò 17-18: –î–û–°–¢–£–ü–ù–û–°–¢–¨ ====================

document.addEventListener('DOMContentLoaded', function() {
    
    // ========== –£–ü–†–ê–í–õ–ï–ù–ò–ï –§–û–ö–£–°–û–ú (–ü–†–ê–ö–¢–ò–ö–ê 17) ==========
    
    function trapFocus(element) {
        const focusableElements = element.querySelectorAll(
            'a[href], button:not([disabled]), textarea:not([disabled]), input:not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"])'
        );
        
        const firstFocusable = focusableElements[0];
        const lastFocusable = focusableElements[focusableElements.length - 1];
        
        element.addEventListener('keydown', function(e) {
            if (e.key !== 'Tab') return;
            
            if (e.shiftKey) {
                if (document.activeElement === firstFocusable) {
                    e.preventDefault();
                    lastFocusable.focus();
                }
            } else {
                if (document.activeElement === lastFocusable) {
                    e.preventDefault();
                    firstFocusable.focus();
                }
            }
        });
    }
    
    // ========== –ü–ï–†–ï–ö–õ–Æ–ß–ê–¢–ï–õ–¨ –¢–ï–ú–´ –° –î–û–°–¢–£–ü–ù–û–°–¢–¨–Æ ==========
    
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = themeToggle?.querySelector('.theme-icon');
    const themeLabel = themeToggle?.querySelector('.sr-only');
    
    if (themeToggle) {
        const savedTheme = localStorage.getItem('theme') || 'light';
        applyTheme(savedTheme);
        
        themeToggle.addEventListener('click', function() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            applyTheme(newTheme);
            localStorage.setItem('theme', newTheme);
        });
        
        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            
            if (themeIcon) {
                themeIcon.textContent = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
            }
            
            if (themeLabel) {
                themeLabel.textContent = theme === 'light' ? '–¢–µ–º–∞: –°–≤–µ—Ç–ª–∞—è' : '–¢–µ–º–∞: –¢—ë–º–Ω–∞—è';
            }
            
            themeToggle.setAttribute('aria-pressed', theme === 'dark' ? 'true' : 'false');
            themeToggle.setAttribute('aria-label', theme === 'light' ? '–í–∫–ª—é—á–∏—Ç—å —Ç—ë–º–Ω—É—é —Ç–µ–º—É' : '–í–∫–ª—é—á–∏—Ç—å —Å–≤–µ—Ç–ª—É—é —Ç–µ–º—É');
        }
    }
    
    // ========== –ê–ö–¢–ò–í–ù–ê–Ø –°–°–´–õ–ö–ê –° aria-current ==========
    
    const currentPage = window.location.pathname.split('/').pop() || 'index.html';
    const navLinks = document.querySelectorAll('.nav__link');
    
    navLinks.forEach(link => {
        const linkPage = link.getAttribute('href');
        if (linkPage === currentPage) {
            link.setAttribute('aria-current', 'page');
            link.classList.add('active');
        } else {
            link.removeAttribute('aria-current');
        }
    });
    
    // ========== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø –° aria-live (–ü–†–ê–ö–¢–ò–ö–ê 18) ==========
    
    let notificationsContainer = document.getElementById('notifications');
    
    if (!notificationsContainer) {
        notificationsContainer = document.createElement('div');
        notificationsContainer.id = 'notifications';
        notificationsContainer.className = 'notifications-container';
        notificationsContainer.setAttribute('role', 'status');
        notificationsContainer.setAttribute('aria-live', 'polite');
        notificationsContainer.setAttribute('aria-atomic', 'true');
        document.body.appendChild(notificationsContainer);
    }
    
    window.showNotification = function(message, type = 'success') {
        const notification = document.createElement('div');
        notification.className = `notification notification--${type}`;
        notification.textContent = message;
        notification.setAttribute('role', 'alert');
        
        notificationsContainer.appendChild(notification);
        
        setTimeout(() => {
            notification.classList.add('notification--show');
        }, 10);
        
        setTimeout(() => {
            notification.classList.remove('notification--show');
            setTimeout(() => {
                notification.remove();
            }, 300);
        }, 3000);
    };
    
    // ========== ANNOUNCE –î–õ–Ø –°–ö–†–ò–ù–†–ò–î–ï–†–û–í ==========
    
    window.announceToScreenReader = function(message) {
        const announcement = document.createElement('div');
        announcement.className = 'sr-only';
        announcement.setAttribute('role', 'status');
        announcement.setAttribute('aria-live', 'polite');
        announcement.textContent = message;
        
        document.body.appendChild(announcement);
        
        setTimeout(() => {
            announcement.remove();
        }, 1000);
    };
    
    // ========== SKIP-LINK ==========
    
    const skipLink = document.querySelector('.skip-link');
    if (skipLink) {
        skipLink.addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.setAttribute('tabindex', '-1');
                target.focus();
                target.scrollIntoView({ behavior: 'smooth' });
            }
        });
    }
    
    // ========== –ò–ù–î–ò–ö–ê–¢–û–† –ó–ê–ì–†–£–ó–ö–ò ==========
    
    window.setLoadingState = function(element, isLoading) {
        element.setAttribute('aria-busy', isLoading ? 'true' : 'false');
        
        if (isLoading) {
            element.classList.add('is-loading');
            announceToScreenReader('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö');
        } else {
            element.classList.remove('is-loading');
            announceToScreenReader('–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
        }
    };
    
    // ========== –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê –ü–†–û–ï–ö–¢–û–í ==========
    
    const projectModal = document.getElementById('projectModal');
    const detailButtons = document.querySelectorAll('.project-details-btn');
    const closeButtons = document.querySelectorAll('[data-close-modal]');
    let lastFocusedElement = null;

    if (projectModal) {
        detailButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                const projectId = this.getAttribute('data-project');
                const project = projectsData[projectId];
                
                if (project) {
                    openProjectModal(project);
                }
            });
        });

        closeButtons.forEach(btn => {
            btn.addEventListener('click', closeProjectModal);
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && !projectModal.hasAttribute('hidden')) {
                closeProjectModal();
            }
        });

        function openProjectModal(project) {
            lastFocusedElement = document.activeElement;
            
            const modalTitle = projectModal.querySelector('.modal__title');
            const modalBody = projectModal.querySelector('.modal__body');

            modalTitle.textContent = project.title;
            
            modalBody.innerHTML = `
                <img src="${project.image}" alt="${project.title}" style="width: 100%; border-radius: 0.5rem; margin-bottom: 1rem;">
                <p style="margin-bottom: 1rem; line-height: 1.7;"><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> ${project.category}</p>
                <p style="margin-bottom: 1rem; line-height: 1.7;">${project.fullDescription}</p>
                <h3 style="margin-bottom: 0.5rem; color: var(--primary-color);">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:</h3>
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 1rem;">
                    ${project.technologies.map(tech => `<span class="tag">${tech}</span>`).join('')}
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 1.5rem; flex-wrap: wrap;">
                    <a href="${project.github}" target="_blank" rel="noopener noreferrer" class="button button--primary">GitHub</a>
                    <a href="${project.demo}" target="_blank" rel="noopener noreferrer" class="button button--secondary">–î–µ–º–æ</a>
                </div>
            `;

            projectModal.removeAttribute('hidden');
            projectModal.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = 'hidden';
            
            const modalContent = projectModal.querySelector('.modal__content');
            if (modalContent) {
                modalContent.focus();
                trapFocus(modalContent);
            }
            
            announceToScreenReader('–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—è–º–∏ –ø—Ä–æ–µ–∫—Ç–∞ –æ—Ç–∫—Ä—ã—Ç–æ');
        }

        function closeProjectModal() {
            projectModal.setAttribute('hidden', '');
            projectModal.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = '';
            
            if (lastFocusedElement) {
                lastFocusedElement.focus();
            }
            
            announceToScreenReader('–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–∫—Ä—ã—Ç–æ');
        }
    }
    
    // ========== –§–ò–õ–¨–¢–†–ê–¶–ò–Ø –ü–†–û–ï–ö–¢–û–í ==========
    
    const filterBtns = document.querySelectorAll('.filter-btn');
    const projectCards = document.querySelectorAll('[data-category]');
    
    if (filterBtns.length > 0) {
        filterBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                filterBtns.forEach(b => {
                    b.classList.remove('active');
                    b.setAttribute('aria-pressed', 'false');
                });
                
                this.classList.add('active');
                this.setAttribute('aria-pressed', 'true');
                
                const filterValue = this.getAttribute('data-filter');
                let visibleCount = 0;
                
                projectCards.forEach(card => {
                    if (filterValue === 'all' || card.getAttribute('data-category') === filterValue) {
                        card.style.display = 'block';
                        setTimeout(() => card.style.opacity = '1', 10);
                        visibleCount++;
                    } else {
                        card.style.opacity = '0';
                        setTimeout(() => card.style.display = 'none', 300);
                    }
                });
                
                const filterText = this.textContent;
                announceToScreenReader(`–§–∏–ª—å—Ç—Ä ${filterText} –ø—Ä–∏–º–µ–Ω—ë–Ω. –ü–æ–∫–∞–∑–∞–Ω–æ –ø—Ä–æ–µ–∫—Ç–æ–≤: ${visibleCount}`);
            });
        });
    }
    
    // ========== –í–ê–õ–ò–î–ê–¶–ò–Ø –§–û–†–ú–´ –ö–û–ù–¢–ê–ö–¢–û–í ==========
    
    const contactForm = document.getElementById('contactForm');
    
    if (contactForm) {
        contactForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('name');
            const email = document.getElementById('email');
            const message = document.getElementById('message');
            
            document.querySelectorAll('.error-message').forEach(el => el.remove());
            document.querySelectorAll('[aria-invalid="true"]').forEach(el => {
                el.setAttribute('aria-invalid', 'false');
                el.classList.remove('input-error');
            });
            
            let isValid = true;
            let firstInvalidField = null;
            
            if (name.value.trim().length < 2) {
                showError(name, '–ò–º—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞');
                isValid = false;
                if (!firstInvalidField) firstInvalidField = name;
            }
            
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email.value.trim())) {
                showError(email, '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email');
                isValid = false;
                if (!firstInvalidField) firstInvalidField = email;
            }
            
            if (message.value.trim().length < 10) {
                showError(message, '–°–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤');
                isValid = false;
                if (!firstInvalidField) firstInvalidField = message;
            }
            
            if (isValid) {
                const submitBtn = contactForm.querySelector('button[type="submit"]');
                setLoadingState(submitBtn, true);
                
                setTimeout(() => {
                    setLoadingState(submitBtn, false);
                    showNotification('‚úì –°–ø–∞—Å–∏–±–æ –∑–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ! –Ø —Å–≤—è–∂—É—Å—å —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.', 'success');
                    contactForm.reset();
                    announceToScreenReader('–§–æ—Ä–º–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞');
                }, 2000);
            } else {
                if (firstInvalidField) {
                    firstInvalidField.focus();
                    announceToScreenReader('–§–æ—Ä–º–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—à–∏–±–∫–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø—Ä–∞–≤—å—Ç–µ –∏—Ö.');
                }
            }
        });
        
        function showError(input, message) {
            input.classList.add('input-error');
            input.setAttribute('aria-invalid', 'true');
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.id = input.id + '-error';
            errorDiv.textContent = message;
            errorDiv.setAttribute('role', 'alert');
            
            input.parentElement.appendChild(errorDiv);
            
            const describedBy = input.getAttribute('aria-describedby') || '';
            input.setAttribute('aria-describedby', describedBy + ' ' + errorDiv.id);
        }
    }
    
    // ========== –ü–õ–ê–í–ù–ê–Ø –ü–†–û–ö–†–£–¢–ö–ê –ö –Ø–ö–û–†–Ø–ú ==========
    
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
            const href = this.getAttribute('href');
            if (href === '#') return;
            
            e.preventDefault();
            const target = document.querySelector(href);
            
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
                
                target.setAttribute('tabindex', '-1');
                target.focus();
            }
        });
    });
});
